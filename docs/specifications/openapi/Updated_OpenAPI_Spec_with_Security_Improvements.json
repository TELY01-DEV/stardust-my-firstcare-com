{
  "openapi": "3.1.0",
  "info": {
    "title": "My FirstCare Opera Panel",
    "description": "# My FirstCare Opera Panel API\n\nA comprehensive Medical IoT Device Management System for healthcare institutions with enhanced security and debugging capabilities.\n\n## üîí **Security Improvements (Latest Update)**\n\n### ‚úÖ **Enhanced Security Features**\n- **Debug Information Protection**: Removed debug print statements that exposed sensitive information\n- **Structured Error Handling**: Comprehensive error responses without internal details exposure\n- **Request ID Tracking**: Every API response includes unique request_id for debugging\n- **Audit Trail**: Complete FHIR R5 compliant audit logging\n- **Role-based Access Control**: Fine-grained permissions and authentication\n\n### ‚úÖ **Production-Ready Debugging System**\n- **Request ID Correlation**: Track issues across logs and audit trails\n- **Hash Audit System**: Complete audit trail with blockchain verification\n- **Raw Document Access**: Deep debugging capabilities for data analysis\n- **Performance Monitoring**: Built-in metrics and analytics\n- **Error Analysis**: Structured error responses with actionable information\n\n## üè• **Device Management**\n- **AVA4 Devices**: Blood pressure, glucose monitoring\n- **Kati Watches**: Continuous vital sign monitoring \n- **Qube-Vital**: Advanced medical sensors\n\n## üë• **Patient Management**\n- Complete patient profiles and medical history\n- Real-time device data integration\n- Multi-hospital support\n- **Raw Document Access**: 431 patients with 269 fields per document\n\n## üîç **Debugging & Troubleshooting**\n\n### **Request ID System**\nEvery API response includes a `request_id` for correlation:\n```json\n{\n  \"success\": true,\n  \"message\": \"Operation completed\",\n  \"data\": {...},\n  \"request_id\": \"a3c3ee46-ddfa-4d94-9e8a-ca2590d9d9fd\",\n  \"timestamp\": \"2025-07-12T03:31:12.123Z\"\n}\n```\n\n### **Debugging Endpoints**\n- **Hash Audit Trail**: `/api/v1/audit/hash/logs?fhir_resource_id={request_id}`\n- **Raw Document Analysis**: `/admin/patients-raw-documents`\n- **AVA4 Debug**: `/api/ava4/debug-patient-query/{patient_id}`\n- **Recent Activity**: `/api/v1/audit/hash/recent?minutes=60`\n\n### **How to Debug Issues**\n1. **Get Request ID** from error response\n2. **Search Audit Logs**: Use hash audit system\n3. **Check Application Logs**: Search Docker logs by request_id\n4. **Analyze Raw Data**: Use raw document endpoints\n\n## üîê **Security & Authentication**\n- **JWT-based Authentication**: All protected endpoints require Bearer tokens\n- **Stardust-V1 Integration**: Centralized authentication system\n- **FHIR R5 Audit Logging**: Complete audit trail with hash verification\n- **Role-based Access Control**: Fine-grained permissions\n- **Request Rate Limiting**: Protection against abuse\n\n## üìä **Analytics & Monitoring**\n- Real-time dashboards\n- Performance metrics\n- Alert management\n- Medical trend analysis\n- **Security Event Logging**: Comprehensive security monitoring\n\n## üõ°Ô∏è **Error Handling**\n\nThe API uses structured error responses with:\n- Consistent error codes and messages\n- Request ID tracking for debugging\n- Detailed field validation\n- Security event logging\n- **No Internal Details Exposure**: Production-safe error messages\n\n## üìã **Raw Patient Document Analysis**\nAccess complete MongoDB patient documents with comprehensive field analysis:\n\n### **Core Patient Fields (269 total)**:\n- **Demographics**: `first_name`, `last_name`, `gender`, `birth_date`, `id_card`, `phone`\n- **Location**: `address_1`, `address_2`, `province_code`, `district_code`, `sub_district_code`\n- **Medical IDs**: `amy_id`, `hn_id_no`, `patient_id`\n- **Emergency Contacts**: `emergency_contact_name`, `emergency_contact_phone`\n\n### **Medical Device Integration (MAC Addresses)**:\n- **AVA4 Devices**: `ava_mac_address`, `ava_box_id`, `ava_sim_card`\n- **Blood Pressure**: `blood_pressure_mac_address`\n- **Blood Glucose**: `blood_glucose_mac_address`\n- **Temperature**: `body_temperature_mac_address`\n- **Pulse Oximetry**: `fingertip_pulse_oximeter_mac_address`\n- **Smartwatches**: `watch_mac_address`\n- **Cholesterol**: `cholesterol_mac_address`\n\n### **Medical Alert Thresholds**:\n- **Blood Pressure**: `bp_sbp_above`, `bp_sbp_below`, `bp_dbp_above`, `bp_dbp_below`\n- **Blood Sugar**: `glucose_normal_before`, `glucose_normal_after`\n- **Temperature**: `temperature_normal_above`, `temperature_normal_below`\n- **SPO2**: `spo2_normal_above`, `spo2_normal_below`\n- **Cholesterol**: `cholesterol_above`, `cholesterol_below`\n\n### **Medical History Fields**:\n- **Vital Signs**: Blood pressure, temperature, SPO2, heart rate\n- **Lab Results**: Creatinine, cholesterol, BUN levels\n- **Body Metrics**: Weight, BMI, body composition\n- **Medication**: Current medications, allergies, dosages\n- **Activity**: Sleep data, step counts, exercise patterns\n\n### **Raw Document Endpoints**:\n- `GET /admin/patients-raw-documents` - Admin access to raw patient documents\n- `GET /api/ava4/patients/raw-documents` - AVA4 specific raw patient data\n- `GET /api/ava4/sub-devices/raw-documents` - Raw device documents with patient linkages\n\n## Authentication\n\nMost endpoints require authentication using JWT Bearer tokens:\n\n1. **Obtain Token**: Use `/auth/login` with valid credentials\n2. **Use Token**: Include `Authorization: Bearer <token>` header\n3. **Refresh Token**: Use `/auth/refresh` when token expires\n\n### Public Endpoints (No Authentication Required)\n- `GET /` - API information\n- `GET /health` - System health check\n- `GET /docs` - API documentation\n- `GET /api/kati/test` - Kati API test endpoint\n- `POST /auth/login` - Authentication login\n- `POST /auth/refresh` - Token refresh\n\n### Protected Endpoints (Authentication Required)\n- All `/admin/*` endpoints\n- All `/api/*/devices` endpoints  \n- All `/api/*/data` endpoints\n- `/auth/me` - Current user information\n\n### **Raw Patient Document Endpoints** (Authentication Required)\n- `GET /admin/patients` - Complete patient documents (269 fields)\n- `GET /admin/patients-raw-documents` - Raw document analysis\n- `GET /api/ava4/patients/raw-documents` - AVA4 patient raw data\n- `GET /api/ava4/sub-devices/raw-documents` - Device-patient linkages\n\n## Database Statistics\n\n- **431 Patients** with complete medical profiles\n- **269 Fields per Patient Document** \n- **6,898 Medical Records** across 14 collections\n- **Real-time IoT Device Integration**\n- **FHIR R5 Compliant Audit Logging**\n- **Enhanced Security Monitoring**\n\n## üöÄ **Latest Updates**\n\n### **Security Enhancements**\n- ‚úÖ Removed debug information exposure\n- ‚úÖ Enhanced error handling without internal details\n- ‚úÖ Improved request ID tracking\n- ‚úÖ Production-ready logging system\n\n### **Debugging Capabilities**\n- ‚úÖ Comprehensive audit trail system\n- ‚úÖ Raw document analysis tools\n- ‚úÖ Performance monitoring\n- ‚úÖ Error correlation by request_id\n\n### **Production Readiness**\n- ‚úÖ Security-hardened error responses\n- ‚úÖ Complete request tracking\n- ‚úÖ Audit trail compliance\n- ‚úÖ Performance optimization\n",
    "version": "1.0.0"
  }
} 